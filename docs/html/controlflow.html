<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Flow of Control</title>
  <meta name="description" content="SmallDragon Flow of Control">
  <meta name="author" content="SmallDragon">

  <link rel="icon" href="../img/favicon.ico">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  <link rel="stylesheet" href="../css/style.css">
</head>

<body>

<div class="container">
	
	<div class="row nav-bg">
		<div class="col"><a href="../index.html">Home</a></div>
	</div>
	
	<h1 class = "mb-3 mt-3">Flow of Control Statements</h1>



<div class="col box">
	<h3> if / else </h3>
<pre><code>
fn main () ~&gt; int {
	
	if 0 &lt; 3 { 
		return 8; 
	} else { 
		return 0; 
	}
	return 0;
}
</code></pre>
</div>


<div class="col box">
	<h3> for, break, continue </h3>
<pre><code>
fn main () ~&gt; int {
	
	for x in 0 .. 3 {
		
		if x == 1 { continue; }
		if x == 2 { break; }
		
		printf("%d\n", x);
	}
	return 0;
}
</code></pre>
</div>

<div class="col box">
	<h3> loop </h3>
<pre><code>
fn main () ~&gt; int {
	
	loop 3 { 
		
		printf("hello \n"); 
	}
	return 0;
}
</code></pre>
</div>

<div class="col box">
	<h3> while </h3>
<pre><code>
fn main () ~&gt; int {
	
	while 2 &lt; 3 { 
		
		printf("hello \n"); 
	}
	return 0;
}
</code></pre>
</div>

<div class="col box">
	<h3> switch </h3>
<pre><code>
fn main () ~&gt; int {
	
	x = 3;
	switch x { 
		case 0 { return 3; }
		
		case 1
		case 2 { return 4; }
	}
	return 0;
}
</code></pre>
</div>


<h3> try / catch [! not yet implemented !]</h3>
<h5>Rules</h5>
<p>
	<ul>
		<li>subroutines can use <strong>throw;</strong></li>
		<li>subroutine s1 must be marked with <strong>throws</strong> if and only if
			<ul>
				<li>s1 uses <strong>throw;</strong> outside any <strong>try</strong> block</li>
				or
				<li>s1 calls a subroutine s2 marked as <strong>throws</strong> outside of a <strong>try</strong> block</li>
			</ul>
		</li>
	</ul>
</p>
<h5>Implementation</h5>
<p>
	The idea is to implement it with setjmp(...) / longjmp(...)
	and passing a hidden jmp_buf* as a parameter
	to subroutines which use <strong>throw</strong>
	/ are marked as <strong>throws</strong>.<br>
	
	Each <strong>try</strong> in a subroutine would
	then cause a separate jmp_buf to be emitted as a local
	variable allocated on the stack. 
	A pointer to this jmp_buf is then passed 
	to all functions in the <strong>try { }</strong> block 
	so they know where to longjmp(...) to.
</p>
<h5>Example</h5>
<pre><code>
fn main () ~&gt; int {
	
	try {
		sub1(3);
	} catch {
		//handle error
	}
	
	try {
		sub1(-1);
	} catch {
		//handle error
	}
	
	return 0;
}

//sub1 receives a hidden jmp_buf parameter
//so it knows which jmp_buf to use with longjmp()
fn sub1 (uint x) -&gt; int throws {
	if x > 0 { throw; }
	return -x;
}
</code></pre>


</div>
</body>
</html>
